<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Static Ear — Chatter · Static contract</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Georama:ital,wght@0,400;0,500;0,600;0,700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0d0c0f;
      --bg-elevated: #121118;
      --surface: #141318;
      --panel: #1a1820;
      --border: #2d2a35;
      --border-focus: #3d3a48;
      --text: #e8e6eb;
      --text-muted: #9a96a5;
      --accent: #8b7cf7;
      --accent-dim: #6d5fd6;
      --accent-glow: rgba(139, 124, 247, 0.25);
      --success: #5cb87a;
      --warn: #d4a84b;
      --danger: #c45c5c;
      --radius: 10px;
      --radius-sm: 6px;
      --font-sans: "Georama", system-ui, sans-serif;
      --font-mono: "JetBrains Mono", monospace;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.35);
      --transition: 0.2s ease;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: var(--font-sans);
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.55;
      background-image:
        radial-gradient(ellipse 100% 60% at 50% -30%, rgba(139, 124, 247, 0.06), transparent 55%),
        radial-gradient(ellipse 80% 40% at 100% 80%, rgba(139, 124, 247, 0.04), transparent 50%);
    }

    .wrap {
      max-width: 720px;
      margin: 0 auto;
      padding: 1.5rem;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
      padding: 1.25rem 0;
      border-bottom: 1px solid var(--border);
      margin-bottom: 1.25rem;
    }

    .logo-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .logo-icon {
      font-size: 1.75rem;
      line-height: 1;
    }

    .logo-text {
      font-weight: 700;
      font-size: 1.4rem;
      color: var(--accent);
      letter-spacing: -0.02em;
    }

    .tagline {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-top: 0.2rem;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .session-badge {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      color: var(--text-muted);
      padding: 0.35rem 0.6rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      max-width: 160px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .btn {
      font-family: var(--font-sans);
      font-size: 0.875rem;
      font-weight: 500;
      padding: 0.5rem 1rem;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      cursor: pointer;
      transition: background var(--transition), border-color var(--transition), transform 0.1s;
    }

    .btn:hover {
      background: var(--surface);
      border-color: var(--accent-dim);
    }

    .btn:active { transform: scale(0.98); }

    .btn-primary {
      background: var(--accent);
      border-color: var(--accent);
      color: var(--bg);
    }

    .btn-primary:hover {
      background: var(--accent-dim);
      border-color: var(--accent-dim);
    }

    /* Stats bar */
    .stats-bar {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      padding: 0.75rem 0;
      margin-bottom: 1rem;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }

    .stat-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--text-muted);
    }

    .stat-dot.active { background: var(--success); }

    /* Chat panel */
    .chat-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      min-height: 340px;
      box-shadow: var(--shadow);
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1.25rem;
      display: flex;
      flex-direction: column;
      gap: 0.85rem;
      min-height: 200px;
    }

    .msg {
      max-width: 88%;
      padding: 0.7rem 1rem;
      border-radius: var(--radius);
      font-size: 0.925rem;
      line-height: 1.5;
      animation: msgIn 0.25s ease;
    }

    @keyframes msgIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .msg .meta {
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
      font-family: var(--font-mono);
    }

    .msg.user {
      align-self: flex-end;
      background: var(--accent);
      color: var(--bg);
      border: none;
    }

    .msg.bot {
      align-self: flex-start;
      background: var(--surface);
      border: 1px solid var(--border);
    }

    .chat-input-area {
      padding: 1rem;
      border-top: 1px solid var(--border);
      background: var(--bg-elevated);
    }

    .chat-input-row {
      display: flex;
      gap: 0.5rem;
      align-items: flex-end;
    }

    .input-wrap {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .chat-input-row input {
      width: 100%;
      font-family: var(--font-sans);
      font-size: 0.95rem;
      padding: 0.6rem 0.9rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--surface);
      color: var(--text);
      transition: border-color var(--transition);
    }

    .chat-input-row input::placeholder { color: var(--text-muted); }

    .chat-input-row input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-glow);
    }

    .char-count {
      font-size: 0.7rem;
      color: var(--text-muted);
      font-family: var(--font-mono);
    }

    .char-count.warn { color: var(--warn); }
    .char-count.max { color: var(--danger); }

    .chat-input-row button { flex-shrink: 0; }

    /* Sections */
    section {
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
    }

    .section-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 0.75rem;
    }

    .section-desc {
      font-size: 0.875rem;
      color: var(--text-muted);
      line-height: 1.6;
      margin-bottom: 1rem;
    }

    .realm-box {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      color: var(--text-muted);
      padding: 0.75rem 1rem;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      word-break: break-all;
      margin-bottom: 1rem;
    }

    .tips-list {
      list-style: none;
    }

    .tips-list li {
      font-size: 0.875rem;
      color: var(--text-muted);
      padding: 0.4rem 0;
      padding-left: 1.25rem;
      position: relative;
    }

    .tips-list li::before {
      content: "·";
      position: absolute;
      left: 0;
      color: var(--accent);
      font-weight: 700;
    }

    .faq-item {
      margin-bottom: 1rem;
    }

    .faq-q {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text);
      margin-bottom: 0.25rem;
    }

    .faq-a {
      font-size: 0.85rem;
      color: var(--text-muted);
      line-height: 1.5;
    }

    /* Footer */
    footer {
      margin-top: 2rem;
      padding: 1.25rem 0;
      border-top: 1px solid var(--border);
      font-size: 0.8rem;
      color: var(--text-muted);
      text-align: center;
    }

    footer a { color: var(--accent); text-decoration: none; }
    footer a:hover { text-decoration: underline; }

    @media (max-width: 560px) {
      .wrap { padding: 1rem; }
      .msg { max-width: 95%; }
      .chat-messages { padding: 1rem; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="logo-row">
          <span class="logo-icon" aria-hidden="true">◉</span>
          <span class="logo-text">Static Ear</span>
        </div>
        <p class="tagline">Chatter · Static contract · Session-based replies</p>
      </div>
      <div class="header-actions">
        <span class="session-badge" id="sid" title="Session ID">—</span>
        <button type="button" class="btn" id="newBtn">New session</button>
      </div>
    </header>

    <div class="stats-bar">
      <div class="stat-item">
        <span class="stat-dot" id="stat-dot"></span>
        <span id="status-text">Start a session to chat.</span>
      </div>
      <div class="stat-item">
        <span id="stat-msgs">0</span> messages this minute
      </div>
      <div class="stat-item">
        <span id="stat-total">0</span> total in session
      </div>
    </div>

    <div class="chat-panel">
      <div class="chat-messages" id="msgs"></div>
      <div class="chat-input-area">
        <div class="chat-input-row">
          <div class="input-wrap">
            <input id="inp" placeholder="Type a message…" maxlength="512" />
            <span class="char-count" id="char-count">0 / 512</span>
          </div>
          <button type="button" class="btn btn-primary" id="sendBtn">Send</button>
        </div>
      </div>
    </div>

    <section aria-labelledby="realm-heading">
      <h2 class="section-title" id="realm-heading">Realm & limits</h2>
      <p class="section-desc">This UI talks to the Static chatter contract. Realm and node bindings are fixed in the contract.</p>
      <div class="realm-box" id="realm-display">0x1f7a3b9e5c0d2e4f6a8b0c2d4e6f8a0b2c4d6e8f0a2b4c6d8e0f2a4b6c8d0e2f4</div>
      <p class="section-desc">Max utterance length: 512 characters. Rate limit: 60 messages per minute per session. Session TTL: 1 hour of inactivity.</p>
    </section>

    <section aria-labelledby="tips-heading">
      <h2 class="section-title" id="tips-heading">Tips</h2>
      <ul class="tips-list">
        <li>Say "hi", "hello", or "hey" to greet.</li>
        <li>Ask "who are you" or "what can you do" to learn about Static.</li>
        <li>Type "help" for support-style replies.</li>
        <li>Say "thanks" or "bye" for acknowledgments and farewells.</li>
        <li>Press Enter to send; start a new session to clear history in this tab.</li>
      </ul>
    </section>

    <section aria-labelledby="faq-heading">
      <h2 class="section-title" id="faq-heading">FAQ</h2>
      <div class="faq-item">
        <div class="faq-q">What is Static?</div>
        <div class="faq-a">Static is a chatter-bot contract (Java). It matches your messages to intents and returns one of several predefined replies. Sessions are scoped; realm and node addresses are fixed at init.</div>
      </div>
      <div class="faq-item">
        <div class="faq-q">What is Static Ear?</div>
        <div class="faq-a">Static Ear is this web interface. It mimics the Static contract behaviour in the browser so you can chat without running the Java backend. Session ID and rate limits mirror the contract.</div>
      </div>
      <div class="faq-item">
        <div class="faq-q">Why do I see "Rate limit"?</div>
        <div class="faq-a">The contract allows 60 messages per minute per session. This page enforces the same limit. Wait a minute or start a new session to reset the counter.</div>
      </div>
    </section>

    <footer>
      Static Ear · Static contract · Chatter bot · Realm: 0x1f7a3b9e5c0d2e4f…
    </footer>
  </div>

  <script>
  (function () {
    var MAX_UTTERANCE = 512;
    var RATE_PER_MIN = 60;
    var STATIC_REALM_ID = "0x1f7a3b9e5c0d2e4f6a8b0c2d4e6f8a0b2c4d6e8f0a2b4c6d8e0f2a4b6c8d0e2f4";

    var intentRules = [
      { p: /^(hi|hello|hey|howdy|yo)\s*!?\s*$/i, r: ["Hi there. What can I do for you?", "Hello. How are you today?", "Hey. Need any help?"] },
      { p: /^(hola|ciao|salut|namaste)\s*!?\s*$/i, r: ["Hi. What can I do for you?", "Hello. How can I help?"] },
      { p: /^(good\s+)?(morning|mornin')\s*!?\s*$/i, r: ["Good morning. Ready when you are.", "Morning. What's on your mind?"] },
      { p: /^(good\s+)?(evening|night)\s*!?\s*$/i, r: ["Good evening. How can I help?", "Evening. Ask me anything."] },
      { p: /thanks?|thank you|ty|thx/i, r: ["You're welcome.", "Glad to help.", "Anytime."] },
      { p: /bye|goodbye|see ya|later|gtg/i, r: ["Bye. Come back if you need anything.", "See you later.", "Take care."] },
      { p: /help|support|assist/i, r: ["I'm here to chat. Tell me what you need.", "Sure. What do you want help with?", "I can try to help. What's the issue?"] },
      { p: /who are you|what are you|are you a bot|your name/i, r: ["I'm Static, a chatter bot. I reply from fixed rules and intents.", "Static here — a bot. I match what you say to predefined replies."] },
      { p: /what can you do|what do you do|your purpose|capabilities/i, r: ["I match your messages to intents and send back one of several possible replies.", "I run in a session: you talk, I reply from a set of rules.", "Chatter only: intent matching and session-scoped replies."] },
      { p: /status|ping|alive|running/i, r: ["I'm running. Session-based chatter contract.", "Status: active. Send me a message.", "Alive. Static realm."] },
      { p: /what\s+(is|are|do|does|can)\b/i, r: ["I'm not sure of the full context. Can you narrow it down?", "That depends on what you mean. Tell me more.", "Good question. I'll need a bit more detail."] },
      { p: /how\s+(do|does|can)\b/i, r: ["There are a few ways. What are you trying to do?", "I can walk you through it. What exactly?", "It depends on the case. More details?"] },
      { p: /^(yes|yeah|yep|ok|okay|sure)\s*!?\s*$/i, r: ["Got it.", "Understood.", "Alright."] },
      { p: /^(no|nope|nah)\s*!?\s*$/i, r: ["Understood.", "No problem.", "Alright."] },
      { p: /sorry|apologize|my bad|oops/i, r: ["No worries.", "It's fine.", "All good."] },
      { p: /(perfect|excellent|awesome|good job)/i, r: ["Thanks.", "Glad it helped.", "Appreciate it."] },
      { p: /(joke|funny|make me laugh)/i, r: ["Why did the bot go to school? To improve its learning rate.", "I'm a static contract — my jokes are constant."] },
      { p: /.*/, r: ["I'm not sure how to reply to that. Try rephrasing.", "I didn't match that to an intent. Want to try something else?", "No specific rule for that. Ask in another way?"] }
    ];

    var sid = null;
    var n = 0;
    var totalInSession = 0;
    var t = Date.now();

    function id() {
      return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (c) {
        return (c === "x" ? Math.random() * 16 | 0 : (Math.random() * 16 | 0) & 3 | 8).toString(16);
      });
    }

    function start() {
      sid = id();
      n = 0;
      totalInSession = 0;
      t = Date.now();
      document.getElementById("sid").textContent = sid.slice(0, 8) + "…";
      document.getElementById("sid").title = sid;
      document.getElementById("stat-dot").classList.add("active");
      document.getElementById("status-text").textContent = "Session active. Chat below.";
      updateStats();
    }

    function reply(txt) {
      var s = (txt || "").trim();
      for (var i = 0; i < intentRules.length; i++) {
        if (intentRules[i].p.test(s)) {
          var replies = intentRules[i].r;
          return replies[Math.floor(Math.random() * replies.length)];
        }
      }
      return intentRules[intentRules.length - 1].r[0];
    }

    function add(role, body) {
      var d = document.createElement("div");
      d.className = "msg " + role;
      d.innerHTML = "<div class=\"meta\">" + (role === "user" ? "You" : "Static") + "</div><div>" + escapeHtml(body) + "</div>";
      document.getElementById("msgs").appendChild(d);
      d.parentNode.scrollTop = d.parentNode.scrollHeight;
    }

    function escapeHtml(s) {
      var div = document.createElement("div");
      div.textContent = s;
      return div.innerHTML;
    }

    function updateStats() {
      document.getElementById("stat-msgs").textContent = n;
      document.getElementById("stat-total").textContent = totalInSession;
      var countEl = document.getElementById("char-count");
      var len = (document.getElementById("inp").value || "").length;
      countEl.textContent = len + " / " + MAX_UTTERANCE;
      countEl.classList.remove("warn", "max");
      if (len >= MAX_UTTERANCE) countEl.classList.add("max");
      else if (len >= MAX_UTTERANCE - 50) countEl.classList.add("warn");
    }

    function send() {
      if (!sid) start();
      var v = document.getElementById("inp").value;
      if (!v || !v.trim()) return;
      if (v.length > MAX_UTTERANCE) {
        add("bot", "That message is too long. Max " + MAX_UTTERANCE + " characters.");
        document.getElementById("inp").value = "";
        updateStats();
        return;
      }
      var now = Date.now();
      if (now - t >= 60000) { t = now; n = 0; }
      if (n >= RATE_PER_MIN) {
        add("bot", "Too many messages this minute. Slow down.");
        updateStats();
        return;
      }
      n++;
      totalInSession++;
      document.getElementById("inp").value = "";
      updateStats();
      add("user", v);
      add("bot", reply(v));
    }

    document.getElementById("sendBtn").onclick = send;
    document.getElementById("inp").onkeydown = function (e) {
      if (e.key === "Enter" && !e.shiftKey) {
